<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã - ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶∂‡¶®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            background-color: #F1F5F9; /* Slate-100 */
        }
        
        /* Chart Container Strict Sizing */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 320px; }
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Input Styling */
        .input-field {
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }
        .input-field:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            outline: none;
        }
        input[readonly] {
            background-color: #f8fafc;
            color: #64748b;
            cursor: not-allowed;
        }

        /* Tab Buttons */
        .tab-btn {
            transition: all 0.2s ease-in-out;
        }
        .tab-btn.active {
            background-color: #10b981;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        /* Badge Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>

    <!-- Chosen Palette: Emerald (Primary/Income), Rose (Expense), Amber (Stock/Warning), Slate (Neutral) -->
    <!-- Application Structure Plan:
         1. Header: Logo, Batch Selector (Global Context).
         2. KPI Cards: 4 Cards (Income, Expense, Profit, Stock) reacting to Batch Context.
         3. Unified Input Section:
            - Tabs for Expense/Income/Stock.
            - Dynamic Form Fields (Category changes based on tab, Auto-calculation of Amount).
            - Custom Category Logic.
         4. Analytics & Data:
            - Left: Doughnut/Bar Chart.
            - Right: Data Table with Filters (All/Exp/Inc/Stock).
         5. Logic: Vanilla JS for state management, localStorage persistence (simulated), and DOM updates.
    -->
    <!-- Visualization & Content Choices:
         - Categories mapped from Source Report (Feed, Medicine, Chicks, Tush, Electricity).
         - Income Categories (Broiler, Sonali, Eggs, Manure).
         - Auto-calculation logic implemented for User Experience.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="text-slate-800 pb-12">

    <!-- Top Navigation & Batch Selector -->
    <nav class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center h-auto md:h-20 py-4 md:py-0 gap-4">
                
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10 bg-emerald-600 rounded-xl flex items-center justify-center text-2xl shadow-lg shadow-emerald-200">üêî</div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-800 leading-tight">‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</h1>
                        <p class="text-xs text-slate-500 font-medium">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ñ‡¶æ‡¶§‡¶æ</p>
                    </div>
                </div>

                <!-- Batch Context Selector -->
                <div class="flex items-center bg-slate-100 p-1.5 rounded-xl border border-slate-200">
                    <span class="px-3 text-xs font-bold text-slate-500 uppercase tracking-wide">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö:</span>
                    <select id="batch-selector" onchange="switchBatch()" class="bg-white text-emerald-700 font-bold text-sm py-1.5 pl-3 pr-8 rounded-lg border-0 focus:ring-2 focus:ring-emerald-500 cursor-pointer hover:bg-emerald-50 transition">
                        <option value="Batch-1">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö-‡ßß</option>
                        <option value="Batch-2">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö-‡ß®</option>
                        <option value="Batch-3">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö-‡ß©</option>
                    </select>
                    <button onclick="createNewBatch()" class="ml-2 bg-slate-800 text-white p-1.5 rounded-lg hover:bg-slate-700 transition" title="‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®">
                        <span class="text-lg leading-none">+</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Section 1: Introduction & Context -->
        <div class="bg-gradient-to-r from-emerald-600 to-emerald-800 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
            <div class="relative z-10">
                <h2 class="text-2xl font-bold mb-2">‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</h2>
                <p class="text-emerald-100 opacity-90 max-w-2xl">
                    ‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö‡ßá‡¶∞ ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ü‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá "‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤" ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
                </p>
            </div>
            <!-- Decorative circle -->
            <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl"></div>
        </div>

        <!-- Section 2: KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Income Card -->
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-emerald-100 hover:shadow-md transition">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-emerald-50 rounded-lg text-emerald-600 text-xl">üí∞</div>
                    <span class="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full">+ ‡¶Ü‡ßü</span>
                </div>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶Ü‡ßü</p>
                <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-income">‡ß≥ ‡ß¶</h3>
            </div>

            <!-- Expense Card -->
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-rose-100 hover:shadow-md transition">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-rose-50 rounded-lg text-rose-600 text-xl">üí∏</div>
                    <span class="text-xs font-bold text-rose-600 bg-rose-50 px-2 py-1 rounded-full">- ‡¶¨‡ßç‡¶Ø‡ßü</span>
                </div>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ñ‡¶∞‡¶ö</p>
                <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-expense">‡ß≥ ‡ß¶</h3>
            </div>

            <!-- Profit Card -->
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-indigo-100 hover:shadow-md transition">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-indigo-50 rounded-lg text-indigo-600 text-xl">üìä</div>
                    <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-full">‡¶®‡¶ø‡¶ü</span>
                </div>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">‡¶≤‡¶æ‡¶≠ / ‡¶ï‡ßç‡¶∑‡¶§‡¶ø</p>
                <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-profit">‡ß≥ ‡ß¶</h3>
            </div>

            <!-- Stock Card -->
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-amber-100 hover:shadow-md transition">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-amber-50 rounded-lg text-amber-600 text-xl">üê§</div>
                    <span class="text-xs font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded-full">‡¶∏‡ßç‡¶ü‡¶ï</span>
                </div>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø</p>
                <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-stock">‡ß¶ ‡¶ü‡¶ø</h3>
            </div>
        </div>

        <!-- Section 3: Unified Input Panel -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                        üìù ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                        <span class="text-xs font-normal text-slate-500 bg-white px-2 py-0.5 rounded border border-slate-200" id="form-batch-badge">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö-‡ßß</span>
                    </h3>
                </div>
                
                <!-- Entry Type Tabs -->
                <div class="flex bg-white p-1 rounded-xl border border-slate-200 w-full md:w-auto shadow-sm">
                    <button onclick="setTab('expense')" id="tab-expense" class="tab-btn active flex-1 px-6 py-2 rounded-lg text-sm transition">‡¶ñ‡¶∞‡¶ö</button>
                    <button onclick="setTab('income')" id="tab-income" class="tab-btn flex-1 px-6 py-2 rounded-lg text-sm transition">‡¶Ü‡ßü/‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</button>
                    <button onclick="setTab('stock')" id="tab-stock" class="tab-btn flex-1 px-6 py-2 rounded-lg text-sm transition">‡¶∏‡ßç‡¶ü‡¶ï</button>
                </div>
            </div>

            <div class="p-6 md:p-8">
                <form id="entry-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-6 items-end">
                    
                    <!-- Date -->
                    <div class="lg:col-span-2 space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="f-date" class="input-field w-full px-4 py-2.5 rounded-xl bg-slate-50">
                    </div>

                    <!-- Category -->
                    <div class="lg:col-span-3 space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase" id="lbl-cat">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label>
                        <select id="f-cat" onchange="checkCustomCat()" class="input-field w-full px-4 py-2.5 rounded-xl bg-slate-50 appearance-none">
                            <!-- Options populated via JS -->
                        </select>
                    </div>

                    <!-- Custom Category Input (Hidden by default) -->
                    <div class="lg:col-span-3 space-y-2 hidden" id="div-custom-cat">
                        <label class="text-xs font-bold text-indigo-500 uppercase">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</label>
                        <input type="text" id="f-custom-cat" placeholder="‡¶â‡¶¶‡¶æ: ‡¶Ø‡¶æ‡¶§‡¶æ‡ßü‡¶æ‡¶§" class="input-field w-full px-4 py-2.5 rounded-xl bg-indigo-50 border-indigo-200 focus:border-indigo-500">
                    </div>

                    <!-- Quantity -->
                    <div class="lg:col-span-2 space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase" id="lbl-qty">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                        <input type="number" id="f-qty" oninput="calculateTotal()" step="0.01" placeholder="0" class="input-field w-full px-4 py-2.5 rounded-xl bg-slate-50 text-center font-medium">
                    </div>

                    <!-- Rate (Unit Price) -->
                    <div class="lg:col-span-2 space-y-2" id="div-rate">
                        <label class="text-xs font-bold text-slate-500 uppercase">‡¶¶‡¶∞ (‡ß≥)</label>
                        <input type="number" id="f-rate" oninput="calculateTotal()" step="0.01" placeholder="0" class="input-field w-full px-4 py-2.5 rounded-xl bg-slate-50 text-center font-medium">
                    </div>

                    <!-- Total Amount (Auto Calc) -->
                    <div class="lg:col-span-3 space-y-2" id="div-amt">
                        <label class="text-xs font-bold text-slate-500 uppercase">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">‡ß≥</span>
                            <input type="number" id="f-amt" placeholder="0" readonly class="input-field w-full pl-8 pr-4 py-2.5 rounded-xl bg-slate-100 text-slate-800 font-bold border-slate-200">
                        </div>
                    </div>

                    <!-- Description/Note -->
                    <div class="lg:col-span-12 space-y-2" id="div-desc">
                        <label class="text-xs font-bold text-slate-500 uppercase" id="lbl-desc">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ / ‡¶®‡ßã‡¶ü</label>
                        <input type="text" id="f-desc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="input-field w-full px-4 py-2.5 rounded-xl bg-slate-50">
                    </div>

                    <!-- Submit Button -->
                    <div class="lg:col-span-12 mt-2">
                        <button type="button" onclick="saveEntry()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-emerald-200 transition transform active:scale-[0.99] flex items-center justify-center gap-2">
                            <span class="text-lg">üíæ</span> ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Section 4: Visuals & Data Table -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left: Charts -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col">
                <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                    üìâ ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£
                </h3>
                <div class="chart-container flex-grow">
                    <canvas id="financeChart"></canvas>
                </div>
                <div class="mt-6 p-4 bg-slate-50 rounded-xl border border-slate-100">
                    <p class="text-xs text-slate-500 text-center leading-relaxed">
                        ‡¶è‡¶á ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö‡ßá‡¶∞ ‡¶Ü‡ßü ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡ßü‡ßá‡¶∞ ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶≤‡¶æ‡¶≠‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¨‡¶æ‡ßú‡¶æ‡¶§‡ßá ‡¶ñ‡¶∞‡¶ö ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§
                    </p>
                </div>
            </div>

            <!-- Right: Transaction History -->
            <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
                <div class="px-6 py-5 border-b border-slate-200 flex flex-col sm:flex-row justify-between items-center gap-4 bg-slate-50">
                    <h3 class="text-lg font-bold text-slate-800">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
                    
                    <!-- Filter -->
                    <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm">
                        <span class="text-xs font-bold text-slate-400 uppercase">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞:</span>
                        <select id="table-filter" onchange="renderTable()" class="text-sm font-bold text-slate-600 bg-transparent border-none focus:ring-0 cursor-pointer">
                            <option value="all">‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã</option>
                            <option value="expense">‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ñ‡¶∞‡¶ö</option>
                            <option value="income">‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡ßü</option>
                            <option value="stock">‡¶∏‡ßç‡¶ü‡¶ï</option>
                        </select>
                    </div>
                </div>

                <div class="flex-grow overflow-x-auto custom-scrollbar">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-white sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th class="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th class="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider text-center">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th class="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider text-right">‡¶ü‡¶æ‡¶ï‡¶æ</th>
                                <th class="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider text-center">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-body" class="divide-y divide-slate-100 text-sm">
                            <!-- Rows will be injected here -->
                        </tbody>
                    </table>
                    
                    <!-- Empty State -->
                    <div id="empty-state" class="hidden flex flex-col items-center justify-center py-12 text-center">
                        <div class="h-16 w-16 bg-slate-50 rounded-full flex items-center justify-center text-3xl mb-4">üì≠</div>
                        <p class="text-slate-500 font-medium">‡¶è‡¶á ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>
                        <p class="text-slate-400 text-xs mt-1">‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 py-8 mt-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-400 text-sm">¬© ‡ß®‡ß¶‡ß®‡ß¨ ‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞ | ‡¶∏‡ßã‡¶∞‡ßç‡¶∏ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶∂‡¶®</p>
        </div>
    </footer>

    <!-- JS Logic -->
    <script>
        // --- State Management ---
        const APP_STATE = {
            batches: JSON.parse(localStorage.getItem('batches')) || ['Batch-1', 'Batch-2'],
            activeBatch: localStorage.getItem('activeBatch') || 'Batch-1',
            transactions: JSON.parse(localStorage.getItem('transactions')) || [],
            currentTab: 'expense'
        };

        let chartInstance = null;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('f-date').valueAsDate = new Date();
            initBatchSelector();
            setTab('expense'); // Default tab
            refreshUI();
        });

        // --- Batch Management ---
        function initBatchSelector() {
            const selector = document.getElementById('batch-selector');
            selector.innerHTML = '';
            APP_STATE.batches.forEach(batch => {
                const opt = document.createElement('option');
                opt.value = batch;
                opt.innerText = batch.replace('-', ' '); // Display 'Batch 1' nicely
                selector.appendChild(opt);
            });
            selector.value = APP_STATE.activeBatch;
        }

        function switchBatch() {
            APP_STATE.activeBatch = document.getElementById('batch-selector').value;
            localStorage.setItem('activeBatch', APP_STATE.activeBatch);
            refreshUI();
        }

        function createNewBatch() {
            const name = prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: Batch-3):");
            if (name && !APP_STATE.batches.includes(name)) {
                APP_STATE.batches.push(name);
                localStorage.setItem('batches', JSON.stringify(APP_STATE.batches));
                
                // Select new batch automatically
                APP_STATE.activeBatch = name;
                localStorage.setItem('activeBatch', name);
                
                initBatchSelector();
                refreshUI();
            }
        }

        // --- Input Form Logic ---
        function setTab(tab) {
            APP_STATE.currentTab = tab;
            
            // UI Toggle
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');

            // Dynamic Form Adjustment
            const catSelect = document.getElementById('f-cat');
            const lblQty = document.getElementById('lbl-qty');
            const divRate = document.getElementById('div-rate');
            const divAmt = document.getElementById('div-amt');
            const divCustom = document.getElementById('div-custom-cat');

            divCustom.classList.add('hidden'); // Hide custom input on tab switch

            if (tab === 'expense') {
                catSelect.innerHTML = `
                    <option value="" disabled selected>‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <optgroup label="‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶ñ‡¶∞‡¶ö">
                        <option value="‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø">‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø (‡¶´‡¶ø‡¶°)</option>
                        <option value="‡¶î‡¶∑‡¶ß">‡¶î‡¶∑‡¶ß / ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ï‡¶∏‡¶ø‡¶®</option>
                        <option value="‡¶¨‡¶æ‡¶ö‡ßç‡¶ö‡¶æ">‡¶¨‡¶æ‡¶ö‡ßç‡¶ö‡¶æ ‡¶ï‡ßç‡¶∞‡ßü</option>
                    </optgroup>
                    <optgroup label="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">
                        <option value="‡¶§‡ßÅ‡¶∑">‡¶§‡ßÅ‡¶∑ / ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞</option>
                        <option value="‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤</option>
                        <option value="‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§">‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§</option>
                        <option value="custom">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø (‡¶®‡¶ø‡¶ú‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®)</option>
                    </optgroup>
                `;
                lblQty.innerText = '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ï‡ßá‡¶ú‡¶ø/‡¶¨‡¶∏‡ßç‡¶§‡¶æ/‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)';
                divRate.classList.remove('hidden');
                divAmt.classList.remove('hidden');
            } 
            else if (tab === 'income') {
                catSelect.innerHTML = `
                    <option value="" disabled selected>‡¶Ü‡ßü‡ßá‡¶∞ ‡¶â‡ßé‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <optgroup label="‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø">
                        <option value="‡¶¨‡ßç‡¶∞‡ßü‡¶≤‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø">‡¶¨‡ßç‡¶∞‡ßü‡¶≤‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø</option>
                        <option value="‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø">‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø</option>
                        <option value="‡¶ï‡¶ï ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø">‡¶ï‡¶ï ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø</option>
                        <option value="‡¶¶‡ßá‡¶∂‡¶ø ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø">‡¶¶‡ßá‡¶∂‡¶ø ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø</option>
                    </optgroup>
                    <optgroup label="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Ü‡ßü">
                        <option value="‡¶°‡¶ø‡¶Æ">‡¶°‡¶ø‡¶Æ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</option>
                        <option value="‡¶∏‡¶æ‡¶∞">‡¶∏‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø (‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞)</option>
                        <option value="custom">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø (‡¶®‡¶ø‡¶ú‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®)</option>
                    </optgroup>
                `;
                lblQty.innerText = '‡¶ì‡¶ú‡¶® (‡¶ï‡ßá‡¶ú‡¶ø) / ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ';
                divRate.classList.remove('hidden');
                divAmt.classList.remove('hidden');
            } 
            else if (tab === 'stock') {
                catSelect.innerHTML = `
                    <option value="mortality">‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø ‡¶Æ‡¶æ‡¶∞‡¶æ ‡¶ó‡ßá‡¶õ‡ßá (Mortality)</option>
                    <option value="new_stock">‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ø‡ßã‡¶ó (New Stock)</option>
                `;
                lblQty.innerText = '‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ (‡¶ü‡¶ø)';
                divRate.classList.add('hidden');
                divAmt.classList.add('hidden');
            }
            
            // Clear fields
            document.getElementById('f-qty').value = '';
            document.getElementById('f-rate').value = '';
            document.getElementById('f-amt').value = '';
            document.getElementById('f-custom-cat').value = '';
            document.getElementById('f-desc').value = '';
        }

        function checkCustomCat() {
            const val = document.getElementById('f-cat').value;
            const divCustom = document.getElementById('div-custom-cat');
            if (val === 'custom') {
                divCustom.classList.remove('hidden');
                document.getElementById('f-custom-cat').focus();
            } else {
                divCustom.classList.add('hidden');
            }
        }

        function calculateTotal() {
            if (APP_STATE.currentTab === 'stock') return;
            
            const qty = parseFloat(document.getElementById('f-qty').value) || 0;
            const rate = parseFloat(document.getElementById('f-rate').value) || 0;
            const total = qty * rate;
            
            document.getElementById('f-amt').value = total > 0 ? total.toFixed(2) : '';
        }

        function saveEntry() {
            const date = document.getElementById('f-date').value;
            let cat = document.getElementById('f-cat').value;
            
            // Handle Custom Category
            if (cat === 'custom') {
                cat = document.getElementById('f-custom-cat').value;
                if (!cat) return alert('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
            }

            const qty = parseFloat(document.getElementById('f-qty').value) || 0;
            const rate = parseFloat(document.getElementById('f-rate').value) || 0;
            const amt = parseFloat(document.getElementById('f-amt').value) || 0;
            const desc = document.getElementById('f-desc').value;

            // Validation
            if (!date || !cat) return alert('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï');
            if (qty <= 0) return alert('‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®');

            const entry = {
                id: Date.now(),
                batchId: APP_STATE.activeBatch,
                type: APP_STATE.currentTab,
                date,
                category: cat,
                quantity: qty,
                rate: rate,
                amount: APP_STATE.currentTab === 'stock' ? 0 : amt, // Stock entries have 0 financial amount here
                description: desc
            };

            APP_STATE.transactions.push(entry);
            localStorage.setItem('transactions', JSON.stringify(APP_STATE.transactions));

            refreshUI();
            
            // Reset crucial fields only
            document.getElementById('f-qty').value = '';
            document.getElementById('f-rate').value = '';
            document.getElementById('f-amt').value = '';
            document.getElementById('f-desc').value = '';
        }

        function deleteEntry(id) {
            if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                APP_STATE.transactions = APP_STATE.transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(APP_STATE.transactions));
                refreshUI();
            }
        }

        // --- UI Rendering ---
        function refreshUI() {
            // Update Headers
            document.getElementById('form-batch-badge').innerText = APP_STATE.activeBatch;

            // Filter data for Active Batch
            const batchData = APP_STATE.transactions.filter(t => t.batchId === APP_STATE.activeBatch);

            // 1. Calculate KPIs
            let income = 0, expense = 0, stockChange = 0;
            
            batchData.forEach(t => {
                if (t.type === 'income') income += t.amount;
                if (t.type === 'expense') expense += t.amount;
                if (t.type === 'stock') {
                    if (t.category === 'mortality') stockChange -= t.quantity;
                    else if (t.category === 'new_stock') stockChange += t.quantity;
                }
            });

            const profit = income - expense;

            // DOM Update KPIs
            document.getElementById('kpi-income').innerText = `‡ß≥ ${income.toLocaleString('bn-BD')}`;
            document.getElementById('kpi-expense').innerText = `‡ß≥ ${expense.toLocaleString('bn-BD')}`;
            const profitEl = document.getElementById('kpi-profit');
            profitEl.innerText = `‡ß≥ ${profit.toLocaleString('bn-BD')}`;
            profitEl.className = `text-2xl font-bold mt-1 ${profit >= 0 ? 'text-emerald-600' : 'text-rose-600'}`;
            document.getElementById('kpi-stock').innerText = `${stockChange} ‡¶ü‡¶ø`;

            // 2. Render Table
            renderTable(batchData);

            // 3. Render Chart
            renderChart(income, expense);
        }

        function renderTable(preFilteredData) {
            const filterType = document.getElementById('table-filter').value;
            
            // If called from selector, we need to refetch batch data
            let data = preFilteredData;
            if (!data) {
                data = APP_STATE.transactions.filter(t => t.batchId === APP_STATE.activeBatch);
            }

            // Apply Type Filter
            if (filterType !== 'all') {
                data = data.filter(t => t.type === filterType);
            }

            // Sort by Date Descending
            data.sort((a, b) => new Date(b.date) - new Date(a.date));

            const tbody = document.getElementById('transaction-body');
            const emptyState = document.getElementById('empty-state');
            tbody.innerHTML = '';

            if (data.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                data.forEach(t => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-slate-50 transition border-b border-slate-50 animate-fade-in';
                    
                    // Badge Logic
                    let badgeClass = 'bg-slate-100 text-slate-600';
                    let amountClass = 'text-slate-600';
                    let amountPrefix = '‡ß≥ ';
                    
                    if (t.type === 'expense') {
                        badgeClass = 'bg-rose-50 text-rose-600 border border-rose-100';
                        amountClass = 'text-rose-600';
                    } else if (t.type === 'income') {
                        badgeClass = 'bg-emerald-50 text-emerald-600 border border-emerald-100';
                        amountClass = 'text-emerald-600';
                    } else if (t.type === 'stock') {
                        badgeClass = 'bg-amber-50 text-amber-600 border border-amber-100';
                        amountClass = 'text-amber-600';
                        amountPrefix = '';
                    }

                    // Format Category Text
                    let catText = t.category;
                    if(catText === 'mortality') catText = '‡¶Æ‡ßÉ‡¶§‡ßç‡¶Ø‡ßÅ';
                    if(catText === 'new_stock') catText = '‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-slate-500 text-xs">${t.date}</td>
                        <td class="px-6 py-4">
                            <div class="flex flex-col">
                                <span class="font-bold text-slate-700">${catText}</span>
                                <span class="text-xs text-slate-400">${t.description || '-'}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="px-2 py-1 rounded-full text-xs font-bold ${badgeClass}">
                                ${t.quantity} ${t.rate > 0 ? '√ó ' + t.rate : ''}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right font-bold ${amountClass}">
                            ${t.amount > 0 ? amountPrefix + t.amount.toLocaleString() : '-'}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <button onclick="deleteEntry(${t.id})" class="text-slate-300 hover:text-rose-500 transition" title="‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®">
                                üóëÔ∏è
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        function renderChart(income, expense) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‡¶Ü‡ßü', '‡¶¨‡ßç‡¶Ø‡ßü'],
                    datasets: [{
                        label: '‡¶ü‡¶æ‡¶ï‡¶æ',
                        data: [income, expense],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)', // Emerald
                            'rgba(244, 63, 94, 0.8)'   // Rose
                        ],
                        borderRadius: 8,
                        barThickness: 50
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: true, color: '#f1f5f9' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>