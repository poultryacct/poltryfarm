<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Bengali', sans-serif; background-color: #f8fafc; }
        .tab-active { border-bottom: 3px solid #10b981; color: #10b981; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-24">

    <!-- Header -->
    <header class="bg-emerald-600 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-lg font-bold">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞</h1>
                <p id="current-date-display" class="text-[10px] opacity-80"></p>
            </div>
            <div id="day-counter" class="bg-emerald-700 px-3 py-1 rounded-full text-xs font-bold">‡¶¶‡¶ø‡¶®: ‡ß¶</div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-4">
        
        <!-- Summary Cards (Updated for separate Income/Expense) -->
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-white p-3 rounded-2xl shadow-sm border-t-4 border-rose-500">
                <p class="text-gray-500 text-[10px] font-bold uppercase">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡ßü (‡¶ñ‡¶∞‡¶ö)</p>
                <h2 id="total-expense" class="text-lg font-bold text-rose-600">‡ß≥ ‡ß¶</h2>
            </div>
            <div class="bg-white p-3 rounded-2xl shadow-sm border-t-4 border-emerald-500">
                <p class="text-gray-500 text-[10px] font-bold uppercase">‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü (‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø)</p>
                <h2 id="total-income" class="text-lg font-bold text-emerald-600">‡ß≥ ‡ß¶</h2>
            </div>
            <div class="bg-emerald-50 p-3 rounded-2xl shadow-sm border border-emerald-100 col-span-2 flex justify-between items-center">
                <p class="text-gray-700 text-xs font-bold">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶®‡¶ø‡¶ü ‡¶≤‡¶æ‡¶≠/‡¶ï‡ßç‡¶∑‡¶§‡¶ø:</p>
                <h2 id="total-profit" class="text-xl font-bold text-gray-800">‡ß≥ ‡ß¶</h2>
            </div>
        </div>

        <!-- Mortality & Health Overview -->
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center">
            <div>
                <p class="text-gray-500 text-[10px] font-bold uppercase">‡¶Æ‡ßÉ‡¶§ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø</p>
                <h2 id="total-mortality" class="text-lg font-bold text-gray-800">‡ß¶ ‡¶ü‡¶ø</h2>
            </div>
            <div class="text-right">
                <button onclick="scrollToHealth()" class="text-emerald-600 text-xs font-bold bg-emerald-50 px-3 py-2 rounded-lg">‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ü©∫</button>
            </div>
        </div>

        <!-- Health Box -->
        <div id="health-section" class="bg-white rounded-2xl shadow-md border-2 border-emerald-50 p-5 space-y-3">
            <h3 class="font-bold text-gray-800 text-sm flex items-center gap-2">
                <span>ü©∫</span> ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶ì ‡¶∞‡ßã‡¶ó ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶ï‡¶æ
            </h3>
            <textarea id="health-input" rows="2" placeholder="‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ù‡¶ø‡¶Æ‡¶æ‡¶ö‡ßç‡¶õ‡ßá, ‡¶ö‡ßÅ‡¶®‡¶æ ‡¶™‡¶æ‡ßü‡¶ñ‡¶æ‡¶®‡¶æ...)" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none"></textarea>
            
            <div id="ai-advice-container" class="hidden bg-emerald-50 border border-emerald-100 p-3 rounded-xl">
                <p class="text-[9px] font-bold text-emerald-700 uppercase">‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂:</p>
                <p id="ai-advice-text" class="text-xs text-gray-700 leading-relaxed"></p>
            </div>

            <button onclick="getAdvice()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl text-sm shadow-sm transition-all active:scale-95">
                ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
        </div>

        <!-- Input Section -->
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
            <div class="flex bg-gray-50 border-b">
                <button onclick="setTab('expense')" id="tab-exp" class="flex-1 py-3 text-sm font-bold tab-active">‡¶¨‡ßç‡¶Ø‡ßü</button>
                <button onclick="setTab('income')" id="tab-inc" class="flex-1 py-3 text-sm font-bold text-gray-400">‡¶Ü‡ßü</button>
                <button onclick="setTab('mortality')" id="tab-mor" class="flex-1 py-3 text-sm font-bold text-gray-400">‡¶Æ‡ßÉ‡¶§‡ßç‡¶Ø‡ßÅ</button>
            </div>
            
            <div class="p-5 space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div class="col-span-2">
                        <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                        <select id="entry-cat" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-xl text-sm font-bold outline-none"></select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                        <input type="number" id="entry-qty" placeholder="‡ß¶" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-xl text-sm font-bold outline-none">
                    </div>
                    <div>
                        <label id="amount-label" class="text-[10px] font-bold text-gray-400 uppercase ml-1">‡¶ü‡¶æ‡¶ï‡¶æ (‡ß≥)</label>
                        <input type="number" id="entry-amount" placeholder="‡ß¶" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-xl text-sm font-bold outline-none">
                    </div>
                </div>
                <button onclick="saveRecord()" class="w-full bg-gray-800 text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95">‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- History List -->
        <div class="space-y-3">
            <div class="flex justify-between items-center px-1">
                <h3 class="font-bold text-gray-600 text-sm">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ñ‡¶æ‡¶§‡¶æ</h3>
                <button onclick="clearAllData()" class="text-[10px] text-rose-400 font-bold uppercase">‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
            </div>
            <div id="history-list" class="space-y-2 pb-10">
                <!-- Records list -->
            </div>
        </div>

    </main>

    <!-- Floating Settings -->
    <button onclick="toggleDateModal()" class="fixed bottom-6 right-6 bg-emerald-600 text-white p-4 rounded-full shadow-2xl z-50">
        üìÖ
    </button>

    <!-- Date Modal -->
    <div id="date-modal" class="fixed inset-0 bg-black/50 hidden z-[100] flex items-center justify-center p-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl">
            <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®</h3>
            <input type="date" id="start-date" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl mb-4 outline-none font-bold text-center">
            <button onclick="saveStartDate()" class="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button onclick="toggleDateModal()" class="w-full text-gray-400 text-sm mt-3">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <script>
        let currentTab = 'expense';
        let records = JSON.parse(localStorage.getItem('poultry_records_v2')) || [];
        let startDate = localStorage.getItem('poultry_start_date_v2') || '';

        const categories = {
            expense: ['‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ (‡¶´‡ßÄ‡¶°)', '‡¶¨‡¶æ‡¶ö‡ßç‡¶ö‡¶æ ‡¶ï‡ßç‡¶∞‡ßü', '‡¶î‡¶∑‡¶ß/‡¶≠‡ßç‡¶Ø‡¶æ‡¶ï‡¶∏‡¶ø‡¶®', '‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤', '‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞', '‡¶≤‡ßá‡¶¨‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö', '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'],
            income: ['‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø', '‡¶°‡¶ø‡¶Æ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø', '‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞/‡¶¨‡¶∏‡ßç‡¶§‡¶æ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø', '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'],
            mortality: ['‡¶Æ‡ßÉ‡¶§ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø']
        };

        const healthRules = [
            { key: '‡¶ö‡ßÅ‡¶®‡¶æ', advice: '‡¶∏‡¶æ‡¶¶‡¶æ ‡¶¨‡¶æ ‡¶ö‡ßÅ‡¶®‡¶æ ‡¶™‡¶æ‡ßü‡¶ñ‡¶æ‡¶®‡¶æ ‡¶ó‡¶æ‡¶Æ‡¶¨‡ßã‡¶∞‡ßã ‡¶¨‡¶æ ‡¶∞‡¶æ‡¶£‡¶ø‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßá‡¶∞ ‡¶≤‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶≠‡¶ø‡¶ú‡ßç‡¶û ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶ï‡ßá‡¶∞ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶®‡¶ø‡¶®‡•§' },
            { key: '‡¶∞‡¶ï‡ßç‡¶§', advice: '‡¶∞‡¶ï‡ßç‡¶§ ‡¶™‡¶æ‡ßü‡¶ñ‡¶æ‡¶®‡¶æ ‡¶ï‡¶ï‡ßç‡¶∏‡¶ø‡¶°‡¶ø‡¶ì‡¶∏‡¶ø‡¶∏ ‡¶è‡¶∞ ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶≤‡¶ï‡ßç‡¶∑‡¶£‡•§ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ü‡¶Æ‡¶™‡ßç‡¶∞‡ßã‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶ï‡¶ï‡ßç‡¶∏‡¶ø-‡¶®‡¶ø‡¶∑‡ßá‡¶ß‡¶ï ‡¶î‡¶∑‡¶ß ‡¶™‡¶æ‡¶®‡¶ø‡¶§‡ßá ‡¶Æ‡¶ø‡¶∂‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶®‡•§' },
            { key: '‡¶ù‡¶ø‡¶Æ‡¶æ‡¶®‡ßã', advice: '‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø ‡¶ù‡¶ø‡¶Æ‡¶æ‡¶®‡ßã ‡¶Æ‡¶æ‡¶®‡ßá ‡¶∂‡¶∞‡ßÄ‡¶∞‡ßá ‡¶ú‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶ö‡¶£‡ßç‡¶° ‡¶¶‡ßÅ‡¶∞‡ßç‡¶¨‡¶≤‡¶§‡¶æ‡•§ ‡¶™‡¶æ‡¶®‡¶ø‡¶§‡ßá ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡ßã‡¶≤‡¶æ‡¶á‡¶ü ‡¶¨‡¶æ ‡¶ó‡ßç‡¶≤‡ßÅ‡¶ï‡ßã‡¶ú ‡¶ì ‡¶≠‡¶ø‡¶ü‡¶æ‡¶Æ‡¶ø‡¶®-‡¶∏‡¶ø ‡¶¶‡¶ø‡¶®‡•§' },
            { key: '‡¶ï‡¶æ‡¶∂‡¶ø', advice: '‡¶†‡¶æ‡¶£‡ßç‡¶°‡¶æ ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßã‡¶®‡¶ø‡ßü‡¶æ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶ò‡¶∞‡ßá ‡¶¨‡¶æ‡¶§‡¶æ‡¶∏ ‡¶ö‡¶≤‡¶æ‡¶ö‡¶≤‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶° ‡¶∂‡ßÅ‡¶∑‡ßç‡¶ï ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§' },
            { key: '‡¶ï‡¶Æ', advice: '‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶Æ ‡¶ñ‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ö‡¶∏‡ßÅ‡¶∏‡ßç‡¶•‡¶§‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶≤‡¶ï‡ßç‡¶∑‡¶£‡•§ ‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶™‡¶æ‡¶§‡ßç‡¶∞ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§' }
        ];

        function setTab(tab) {
            currentTab = tab;
            document.querySelectorAll('button[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('text-gray-400');
            });
            const btnId = tab === 'expense' ? 'tab-exp' : (tab === 'income' ? 'tab-inc' : 'tab-mor');
            document.getElementById(btnId).classList.add('tab-active');
            document.getElementById(btnId).classList.remove('text-gray-400');
            updateCategoryList();
        }

        function updateCategoryList() {
            const select = document.getElementById('entry-cat');
            select.innerHTML = categories[currentTab].map(cat => `<option value="${cat}">${cat}</option>`).join('');
            
            const qtyInput = document.getElementById('entry-qty');
            const amountInput = document.getElementById('entry-amount');
            
            if(currentTab === 'mortality') {
                amountInput.disabled = true;
                amountInput.value = 0;
                qtyInput.placeholder = "‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ";
            } else {
                amountInput.disabled = false;
                qtyInput.placeholder = "‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£";
            }
        }

        function getAdvice() {
            const text = document.getElementById('health-input').value;
            if(!text) return;

            let finalAdvice = "‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶ó‡¶≠‡ßÄ‡¶∞‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶¨‡ßá‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø‡¶¨‡¶ø‡¶ß‡¶ø ‡¶Æ‡ßá‡¶®‡ßá ‡¶ö‡¶≤‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶ï‡ßá‡¶∞ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂ ‡¶®‡¶ø‡¶®‡•§";
            for(let rule of healthRules) {
                if(text.includes(rule.key)) {
                    finalAdvice = rule.advice;
                    break;
                }
            }

            document.getElementById('ai-advice-container').classList.remove('hidden');
            document.getElementById('ai-advice-text').innerText = finalAdvice;
            saveRecord(true, text);
        }

        function saveRecord(isHealth = false, healthNote = "") {
            const cat = isHealth ? "‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü" : document.getElementById('entry-cat').value;
            const qty = isHealth ? 0 : parseFloat(document.getElementById('entry-qty').value) || 0;
            const amount = isHealth ? 0 : parseFloat(document.getElementById('entry-amount').value) || 0;
            const type = isHealth ? 'mortality' : currentTab;

            if(!isHealth && (qty <= 0 && amount <= 0)) return;

            const record = {
                id: Date.now(),
                type: type,
                cat: cat,
                qty: qty,
                amount: amount,
                note: healthNote,
                date: new Date().toLocaleDateString('bn-BD', { day: 'numeric', month: 'short' })
            };

            records.push(record);
            localStorage.setItem('poultry_records_v2', JSON.stringify(records));
            
            if(!isHealth) {
                document.getElementById('entry-qty').value = '';
                document.getElementById('entry-amount').value = '';
            }
            render();
        }

        function deleteRecord(id) {
            records = records.filter(r => r.id !== id);
            localStorage.setItem('poultry_records_v2', JSON.stringify(records));
            render();
        }

        function clearAllData() {
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                records = [];
                localStorage.removeItem('poultry_records_v2');
                render();
            }
        }

        function render() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            
            let totalIncome = 0;
            let totalExpense = 0;
            let totalMortality = 0;

            records.slice().reverse().forEach(r => {
                if(r.type === 'income') totalIncome += r.amount;
                if(r.type === 'expense') totalExpense += r.amount;
                if(r.cat === '‡¶Æ‡ßÉ‡¶§ ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø') totalMortality += r.qty;

                const colorClass = r.type === 'income' ? 'text-emerald-600' : (r.type === 'expense' ? 'text-rose-600' : 'text-gray-500');
                const sign = r.type === 'income' ? '+' : (r.type === 'expense' ? '-' : '');

                list.insertAdjacentHTML('beforeend', `
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center transition-all animate-in fade-in">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-gray-800 text-sm">${r.cat}</span>
                                <span class="text-[9px] bg-gray-50 px-1.5 py-0.5 rounded text-gray-400">${r.date}</span>
                            </div>
                            <p class="text-[10px] text-gray-400 mt-0.5">${r.note || (r.qty > 0 ? '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ' + r.qty : '')}</p>
                        </div>
                        <div class="text-right flex items-center gap-3">
                            <span class="font-bold text-sm ${colorClass}">${r.amount > 0 ? sign + ' ‡ß≥' + r.amount : (r.qty > 0 ? r.qty + ' ‡¶ü‡¶ø' : '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü')}</span>
                            <button onclick="deleteRecord(${r.id})" class="text-gray-300 hover:text-rose-400">‚úï</button>
                        </div>
                    </div>
                `);
            });

            document.getElementById('total-income').innerText = `‡ß≥ ${totalIncome}`;
            document.getElementById('total-expense').innerText = `‡ß≥ ${totalExpense}`;
            document.getElementById('total-profit').innerText = `‡ß≥ ${totalIncome - totalExpense}`;
            document.getElementById('total-mortality').innerText = `${totalMortality} ‡¶ü‡¶ø`;
            
            updateDayCounter();
        }

        function updateDayCounter() {
            if(startDate) {
                const start = new Date(startDate);
                const today = new Date();
                const diffTime = today - start;
                const diffDays = Math.max(0, Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1);
                document.getElementById('day-counter').innerText = `‡¶¶‡¶ø‡¶®: ${diffDays}`;
            }
        }

        function toggleDateModal() {
            document.getElementById('date-modal').classList.toggle('hidden');
        }

        function saveStartDate() {
            startDate = document.getElementById('start-date').value;
            localStorage.setItem('poultry_start_date_v2', startDate);
            toggleDateModal();
            updateDayCounter();
        }

        function scrollToHealth() {
            document.getElementById('health-section').scrollIntoView({ behavior: 'smooth' });
        }

        window.onload = () => {
            const today = new Date();
            document.getElementById('current-date-display').innerText = today.toLocaleDateString('bn-BD', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            if(startDate) document.getElementById('start-date').value = startDate;
            setTab('expense');
            render();
        };
    </script>
</body>
</html>
