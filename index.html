<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶™‡ßç‡¶∞‡ßã - ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            background-color: #F8FAFC;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 250px;
        }
        .tab-btn.active {
            background-color: #059669;
            color: white;
        }
        
        /* PDF optimizations */
        .pdf-content {
            width: 100%;
            background: white !important;
        }
        
        /* Force page breaks for long tables */
        .html2pdf__page-break {
            height: 0;
            page-break-before: always;
        }

        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="text-slate-800 pb-10">

    <nav class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-3xl">üê§</span>
                <div>
                    <h1 class="text-lg font-bold text-emerald-800 leading-tight">‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã</h1>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">‡¶è‡¶ï‡ßç‡¶∏‡¶™‡¶æ‡¶∞‡ßç‡¶ü ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button onclick="downloadCompleteReport()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg flex items-center gap-2 transition-all shadow-lg font-bold text-sm">
                    üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü (PDF)
                </button>
                <select id="batch-selector" onchange="switchBatch()" class="bg-slate-100 text-emerald-700 font-bold text-sm py-2 px-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none">
                </select>
            </div>
        </div>
    </nav>

    <div id="capture-area" class="p-4 max-w-7xl mx-auto space-y-6">
        
        <!-- Hidden Header for PDF Only -->
        <div id="pdf-only-header" class="hidden text-center border-b-4 border-emerald-600 pb-6 mb-8">
            <h1 class="text-3xl font-black text-slate-900">‡¶™‡ßã‡¶≤‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h1>
            <div class="flex justify-center gap-10 mt-4 text-sm font-bold text-slate-600">
                <p id="pdf-batch-display"></p>
                <p id="pdf-date-display"></p>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 border-l-4 border-emerald-500">
                <p class="text-slate-500 text-[10px] font-bold uppercase tracking-wider">‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p>
                <h3 class="text-2xl font-black text-emerald-600" id="kpi-income">‡ß≥ ‡ß¶</h3>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 border-l-4 border-rose-500">
                <p class="text-slate-500 text-[10px] font-bold uppercase tracking-wider">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡ßü</p>
                <h3 class="text-2xl font-black text-rose-600" id="kpi-expense">‡ß≥ ‡ß¶</h3>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 border-l-4 border-blue-500">
                <p class="text-slate-500 text-[10px] font-bold uppercase tracking-wider">‡¶≤‡¶æ‡¶≠/‡¶ï‡ßç‡¶∑‡¶§‡¶ø</p>
                <h3 class="text-2xl font-black text-slate-700" id="kpi-profit">‡ß≥ ‡ß¶</h3>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 border-l-4 border-amber-500">
                <p class="text-slate-500 text-[10px] font-bold uppercase tracking-wider">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï</p>
                <h3 class="text-2xl font-black text-amber-600" id="kpi-stock">‡ß¶ ‡¶ü‡¶ø</h3>
            </div>
        </div>

        <!-- Forms Section (Hidden in PDF via CSS) -->
        <div class="no-print space-y-6">
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-50 px-5 py-3 border-b border-slate-200 flex justify-between items-center">
                    <h3 class="font-bold text-slate-700 text-sm">‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
                    <div class="flex bg-slate-200 p-1 rounded-xl">
                        <button onclick="setTab('expense')" id="tab-expense" class="tab-btn active px-4 py-1.5 rounded-lg text-[11px] font-bold transition-all">‡¶¨‡ßç‡¶Ø‡ßü</button>
                        <button onclick="setTab('income')" id="tab-income" class="tab-btn px-4 py-1.5 rounded-lg text-[11px] font-bold transition-all">‡¶Ü‡ßü</button>
                        <button onclick="setTab('stock')" id="tab-stock" class="tab-btn px-4 py-1.5 rounded-lg text-[11px] font-bold transition-all">‡¶∏‡ßç‡¶ü‡¶ï</button>
                    </div>
                </div>
                <div class="p-6">
                    <form id="entry-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                            <input type="date" id="f-date" class="w-full px-3 py-2 rounded-lg bg-slate-50 border border-slate-200 text-sm">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                            <select id="f-cat" class="w-full px-3 py-2 rounded-lg bg-slate-50 border border-slate-200 text-sm font-medium"></select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                            <input type="number" id="f-qty" oninput="autoCalc()" placeholder="‡ß¶" class="w-full px-3 py-2 rounded-lg bg-slate-50 border border-slate-200 text-sm font-bold">
                        </div>
                        <div class="space-y-1" id="div-rate">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">‡¶¶‡¶∞ (‡¶ü‡¶æ‡¶ï‡¶æ)</label>
                            <input type="number" id="f-rate" oninput="autoCalc()" placeholder="‡ß¶" class="w-full px-3 py-2 rounded-lg bg-slate-50 border border-slate-200 text-sm font-bold">
                        </div>
                        <div class="space-y-1" id="div-total">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</label>
                            <input type="number" id="f-total" readonly class="w-full px-3 py-2 rounded-lg bg-emerald-50 border border-emerald-100 text-sm font-black text-emerald-700">
                        </div>
                        <button type="button" onclick="saveEntry()" class="bg-emerald-600 text-white font-bold py-2 rounded-lg hover:bg-emerald-700 shadow-md text-sm">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </form>
                </div>
            </section>
        </div>

        <!-- Charts and Reports Summary -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="px-5 py-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                    <h3 class="font-bold text-sm text-slate-700">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶∏‡¶ï‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ)</h3>
                    <span class="text-[10px] bg-indigo-100 text-indigo-700 px-2 py-1 rounded font-bold uppercase no-print">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</span>
                </div>
                <div class="overflow-x-auto">
                    <table id="main-table" class="w-full text-xs text-left">
                        <thead class="bg-slate-50 text-slate-500 border-b border-slate-200 font-bold">
                            <tr>
                                <th class="px-5 py-4">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th class="px-5 py-4">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th class="px-5 py-4 text-center">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th class="px-5 py-4 text-right">‡¶¶‡¶∞</th>
                                <th class="px-5 py-4 text-right">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th>
                                <th class="px-5 py-4 text-center no-print">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-body" class="divide-y divide-slate-100">
                            <!-- Rows injected here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Visual Summary -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-[11px] text-slate-400 uppercase mb-6">‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</h3>
                    <div class="chart-container">
                        <canvas id="financeChart"></canvas>
                    </div>
                </div>

                <!-- Footer Summary for PDF -->
                <div class="bg-emerald-50 p-6 rounded-2xl border border-emerald-100 space-y-4">
                    <h4 class="font-bold text-emerald-800 text-sm">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø ‡¶®‡ßã‡¶ü</h4>
                    <p class="text-xs text-emerald-600 leading-relaxed">‡¶è‡¶á ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶Ü‡ßü, ‡¶¨‡ßç‡¶Ø‡ßü ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶è‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡ßÅ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡ßü‡¶Æ‡¶ø‡¶§ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡¶ø‡¶®‡•§</p>
                    <div class="pt-4 border-t border-emerald-200">
                        <div class="flex justify-between text-xs font-bold text-emerald-800">
                            <span>‡¶®‡ßá‡¶ü ‡¶≤‡¶æ‡¶≠/‡¶ï‡ßç‡¶∑‡¶§‡¶ø:</span>
                            <span id="summary-profit-val">‡ß≥ ‡ß¶</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STATE = {
            batches: JSON.parse(localStorage.getItem('p_batches_v4')) || ['Batch-01', 'Batch-02'],
            activeBatch: localStorage.getItem('p_active_v4') || 'Batch-01',
            entries: JSON.parse(localStorage.getItem('p_data_v4')) || [],
            currentTab: 'expense'
        };

        let myChart = null;

        window.onload = () => {
            document.getElementById('f-date').valueAsDate = new Date();
            updateBatchList();
            setTab('expense');
            refreshUI();
        };

        function updateBatchList() {
            const el = document.getElementById('batch-selector');
            el.innerHTML = STATE.batches.map(b => `<option value="${b}">${b}</option>`).join('');
            el.value = STATE.activeBatch;
        }

        function switchBatch() {
            STATE.activeBatch = document.getElementById('batch-selector').value;
            localStorage.setItem('p_active_v4', STATE.activeBatch);
            refreshUI();
        }

        function setTab(tab) {
            STATE.currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            const cat = document.getElementById('f-cat');
            const rateDiv = document.getElementById('div-rate');
            const totalDiv = document.getElementById('div-total');
            
            if(tab === 'expense') {
                cat.innerHTML = `<option value="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option><option value="‡¶¨‡¶æ‡¶ö‡ßç‡¶ö‡¶æ">‡¶¨‡¶æ‡¶ö‡ßç‡¶ö‡¶æ</option><option value="‡¶î‡¶∑‡¶ß">‡¶î‡¶∑‡¶ß</option><option value="‡¶≤‡ßá‡¶¨‡¶æ‡¶∞">‡¶≤‡ßá‡¶¨‡¶æ‡¶∞</option><option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ñ‡¶∞‡¶ö</option>`;
                rateDiv.classList.remove('hidden');
                totalDiv.classList.remove('hidden');
            } else if(tab === 'income') {
                cat.innerHTML = `<option value="‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø">‡¶Æ‡ßÅ‡¶∞‡¶ó‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</option><option value="‡¶°‡¶ø‡¶Æ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø">‡¶°‡¶ø‡¶Æ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</option><option value="‡¶∏‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø">‡¶∏‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</option>`;
                rateDiv.classList.remove('hidden');
                totalDiv.classList.remove('hidden');
            } else {
                cat.innerHTML = `<option value="‡¶∏‡ßç‡¶ü‡¶ï ‡¶á‡¶®">‡¶∏‡ßç‡¶ü‡¶ï ‡¶á‡¶® (+)</option><option value="‡¶Æ‡ßÉ‡¶§‡ßç‡¶Ø‡ßÅ">‡¶Æ‡ßÉ‡¶§‡ßç‡¶Ø‡ßÅ (-)</option>`;
                rateDiv.classList.add('hidden');
                totalDiv.classList.add('hidden');
            }
            autoCalc();
        }

        function autoCalc() {
            const qty = parseFloat(document.getElementById('f-qty').value) || 0;
            const rate = parseFloat(document.getElementById('f-rate').value) || 0;
            document.getElementById('f-total').value = (qty * rate) || '';
        }

        function saveEntry() {
            const qty = parseFloat(document.getElementById('f-qty').value) || 0;
            const rate = parseFloat(document.getElementById('f-rate').value) || 0;
            const date = document.getElementById('f-date').value;
            
            if(qty <= 0 || !date) return;

            STATE.entries.push({
                id: Date.now(),
                batch: STATE.activeBatch,
                tab: STATE.currentTab,
                date: date,
                cat: document.getElementById('f-cat').value,
                qty: qty,
                rate: rate,
                total: STATE.currentTab === 'stock' ? 0 : (qty * rate)
            });

            localStorage.setItem('p_data_v4', JSON.stringify(STATE.entries));
            document.getElementById('f-qty').value = '';
            document.getElementById('f-rate').value = '';
            refreshUI();
        }

        function deleteEntry(id) {
            STATE.entries = STATE.entries.filter(e => e.id !== id);
            localStorage.setItem('p_data_v4', JSON.stringify(STATE.entries));
            refreshUI();
        }

        function refreshUI() {
            const data = STATE.entries.filter(e => e.batch === STATE.activeBatch);
            let inc = 0, exp = 0, stock = 0;

            data.sort((a,b) => new Date(b.date) - new Date(a.date));

            data.forEach(e => {
                if(e.tab === 'income') inc += e.total;
                if(e.tab === 'expense') exp += e.total;
                if(e.tab === 'stock') stock += (e.cat === '‡¶∏‡ßç‡¶ü‡¶ï ‡¶á‡¶®' ? e.qty : -e.qty);
            });

            const profit = inc - exp;
            document.getElementById('kpi-income').innerText = `‡ß≥ ${inc.toLocaleString()}`;
            document.getElementById('kpi-expense').innerText = `‡ß≥ ${exp.toLocaleString()}`;
            document.getElementById('kpi-profit').innerText = `‡ß≥ ${profit.toLocaleString()}`;
            document.getElementById('kpi-stock').innerText = `${stock} ‡¶ü‡¶ø`;
            document.getElementById('summary-profit-val').innerText = `‡ß≥ ${profit.toLocaleString()}`;

            document.getElementById('transaction-body').innerHTML = data.map(e => `
                <tr class="hover:bg-slate-50 transition-colors border-b border-slate-50">
                    <td class="px-5 py-4 font-bold text-slate-400">${e.date}</td>
                    <td class="px-5 py-4 font-bold text-slate-700">${e.cat}</td>
                    <td class="px-5 py-4 text-center font-bold">${e.qty}</td>
                    <td class="px-5 py-4 text-right text-slate-500">${e.tab==='stock'?'-':'‡ß≥'+e.rate.toLocaleString()}</td>
                    <td class="px-5 py-4 text-right font-black ${e.tab==='income'?'text-emerald-600':'text-rose-600'}">${e.tab==='stock'?'-':'‡ß≥'+e.total.toLocaleString()}</td>
                    <td class="px-5 py-4 text-center no-print">
                        <button onclick="deleteEntry(${e.id})" class="text-rose-300 hover:text-rose-600 transition-colors">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');

            updateChart(inc, exp);
        }

        function updateChart(inc, exp) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['‡¶Ü‡ßü', '‡¶¨‡ßç‡¶Ø‡ßü'],
                    datasets: [{
                        data: [inc || 1, exp || 0.1],
                        backgroundColor: ['#10b981', '#f43f5e'],
                        borderColor: '#ffffff',
                        borderWidth: 4
                    }]
                },
                options: { 
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom',
                            labels: { font: { family: 'Noto Sans Bengali', weight: 'bold' } }
                        } 
                    } 
                }
            });
        }

        // The Fix: Complete Data PDF Generation
        async function downloadCompleteReport() {
            const element = document.getElementById('capture-area');
            const pdfHeader = document.getElementById('pdf-only-header');
            const nav = document.querySelector('nav');
            
            // UI Preparation
            pdfHeader.classList.remove('hidden');
            document.getElementById('pdf-batch-display').innerText = `‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö: ${STATE.activeBatch}`;
            document.getElementById('pdf-date-display').innerText = `‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${new Date().toLocaleDateString('bn-BD')}`;
            
            // Set options for high resolution and full data
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5],
                filename: `Poultry_Report_${STATE.activeBatch}_${Date.now()}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    logging: false,
                    scrollY: 0,
                    windowWidth: document.documentElement.offsetWidth
                },
                jsPDF: { 
                    unit: 'in', 
                    format: 'a4', 
                    orientation: 'portrait' 
                },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // Process and Save
            try {
                await html2pdf().set(opt).from(element).save();
            } catch (err) {
                console.error("PDF generation error:", err);
            } finally {
                pdfHeader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
